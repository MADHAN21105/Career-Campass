<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Career Coach - Career Compass</title>
    <meta name="description" content="Chat with your personal AI Career Coach for resume tips and interview prep.">
    <link rel="icon" type="image/png" href="../images/favicon.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        background: "#ffffff",
                        foreground: "#0f172a",
                        primary: {
                            DEFAULT: "#6366f1",
                            foreground: "#ffffff",
                        },
                        secondary: {
                            DEFAULT: "#f1f5f9",
                            foreground: "#0f172a",
                        },
                        muted: {
                            DEFAULT: "#f1f5f9",
                            foreground: "#64748b",
                        },
                        accent: {
                            DEFAULT: "#8b5cf6",
                            foreground: "#ffffff",
                        },
                        border: "hsl(var(--border))",
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            :root {
                --border: 240 5.9% 90%;
            }
        }
        .chat-scroll::-webkit-scrollbar { width: 6px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
    </style>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-50 text-foreground h-screen overflow-hidden font-sans antialiased flex flex-col">

    <!-- Navigation Bar -->
    <header
        class="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div class="container flex h-14 max-w-screen-2xl items-center justify-between px-4 mx-auto">
            <!-- Left Section: Logo + Desktop Nav -->
            <div class="flex items-center gap-8">
                <!-- Logo -->
                <a href="index.html" class="flex items-center gap-2 font-bold">
                    <img src="../images/logo.png" alt="Career Compass Logo" class="w-12 h-12 rounded-full">
                    <span class="hidden sm:inline-block">Career Compass</span>
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
                    <a href="resume-analysis.html" class="transition-colors text-foreground hover:text-primary">Job
                        Analysis Fit</a>
                    <a href="cover-letter-generator.html"
                        class="transition-colors text-foreground hover:text-primary">Cover Letter
                        Generator</a>
                    <a href="ai-career-coach.html" class="transition-colors text-foreground hover:text-primary">AI
                        Career Coach</a>
                    <a href="resume-guide.html" class="transition-colors text-foreground hover:text-primary">Resume
                        Guide</a>
                </nav>
            </div>

            <!-- Mobile Menu Toggle -->
            <button id="mobile-menu-btn"
                class="md:hidden inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 w-9">
                <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu"
            class="hidden md:hidden border-t border-border bg-background p-4 absolute w-full left-0 top-14 shadow-lg">
            <nav class="flex flex-col gap-4">
                <a href="resume-analysis.html" class="text-sm font-medium hover:text-primary">Job Analysis Fit</a>
                <a href="cover-letter-generator.html" class="text-sm font-medium hover:text-primary">Cover Letter
                    Generator</a>
                <a href="ai-career-coach.html" class="text-sm font-medium hover:text-primary">AI Career Coach</a>
                <a href="resume-guide.html" class="text-sm font-medium hover:text-primary">Resume Guide</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto max-w-5xl px-4 py-4 md:py-6 overflow-hidden">

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 h-full">

            <!-- Sidebar (Left) - Capabilities & Quick Questions -->
            <div class="hidden lg:flex flex-col gap-3 lg:col-span-1 overflow-y-auto pr-2">

                <!-- Quick Questions Card -->
                <div class="bg-white border border-gray-200 rounded-xl p-3 shadow-sm">
                    <div class="flex items-center gap-2 mb-2 text-primary">
                        <i data-lucide="zap" class="w-4 h-4"></i>
                        <h3 class="font-bold text-xs uppercase tracking-wide">Quick Questions</h3>
                    </div>
                    <div class="space-y-1.5">
                        <button
                            class="quick-q w-full text-left text-xs p-2 rounded-lg bg-gray-50 hover:bg-primary/10 hover:text-primary transition-colors border border-gray-100 flex items-center justify-between group">
                            How do I improve my resume?
                            <i data-lucide="chevron-right"
                                class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                        <button
                            class="quick-q w-full text-left text-xs p-2 rounded-lg bg-gray-50 hover:bg-primary/10 hover:text-primary transition-colors border border-gray-100 flex items-center justify-between group">
                            What skills should I learn?
                            <i data-lucide="chevron-right"
                                class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                        <button
                            class="quick-q w-full text-left text-xs p-2 rounded-lg bg-gray-50 hover:bg-primary/10 hover:text-primary transition-colors border border-gray-100 flex items-center justify-between group">
                            How to prepare for interviews?
                            <i data-lucide="chevron-right"
                                class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                        <button
                            class="quick-q w-full text-left text-xs p-2 rounded-lg bg-gray-50 hover:bg-primary/10 hover:text-primary transition-colors border border-gray-100 flex items-center justify-between group">
                            Career change advice
                            <i data-lucide="chevron-right"
                                class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                        <button
                            class="quick-q w-full text-left text-xs p-2 rounded-lg bg-gray-50 hover:bg-primary/10 hover:text-primary transition-colors border border-gray-100 flex items-center justify-between group">
                            Salary negotiation tips
                            <i data-lucide="chevron-right"
                                class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                    </div>
                </div>

                <!-- Why Use Card -->
                <div class="bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl p-3 shadow-md text-white">
                    <h3 class="font-bold text-sm mb-2 flex items-center gap-2">
                        <i data-lucide="star" class="w-4 h-4 fill-current"></i> Why Use Our AI?
                    </h3>
                    <ul class="space-y-2 text-xs">
                        <li class="flex gap-3">
                            <div
                                class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
                                <i data-lucide="clock" class="w-3 h-3"></i>
                            </div>
                            <div>
                                <span class="font-bold block">24/7 Availability</span>
                                <span class="text-white/80 text-[10px]">Instant answers anytime</span>
                            </div>
                        </li>
                        <li class="flex gap-3">
                            <div
                                class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
                                <i data-lucide="user-check" class="w-3 h-3"></i>
                            </div>
                            <div>
                                <span class="font-bold block">Personalized Advice</span>
                                <span class="text-white/80 text-[10px]">Tailored recommendations</span>
                            </div>
                        </li>
                        <li class="flex gap-3">
                            <div
                                class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
                                <i data-lucide="brain-circuit" class="w-3 h-3"></i>
                            </div>
                            <div>
                                <span class="font-bold block">Expert Knowledge</span>
                                <span class="text-white/80 text-[10px]">Industry best practices</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Chat Area (Center/Right) -->
            <div
                class="lg:col-span-3 flex flex-col h-full bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden">

                <!-- Chat Header -->
                <div class="border-b border-gray-100 p-3 flex items-center justify-between bg-white z-10">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                            <i data-lucide="bot" class="w-5 h-5 text-primary"></i>
                        </div>
                        <div>
                            <h2 class="font-bold text-sm text-gray-900">Career Compass Assistant</h2>
                            <div class="flex items-center gap-1.5">
                                <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                                <span class="text-[10px] font-medium text-green-600">Online</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right hidden sm:block">
                        <p class="text-xs font-semibold text-gray-900">AI Career Assistant</p>
                        <p class="text-[10px] text-gray-500">Get personalized career advice</p>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div id="chat-messages"
                    class="flex-1 p-6 overflow-y-auto chat-scroll flex flex-col gap-6 bg-gray-50/30">

                    <!-- Welcome Message -->
                    <div class="flex gap-4 max-w-2xl">
                        <div
                            class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-1">
                            <i data-lucide="bot" class="w-5 h-5 text-primary"></i>
                        </div>
                        <div class="flex flex-col gap-2">
                            <div
                                class="bg-white border border-gray-200 p-4 rounded-2xl rounded-tl-none shadow-sm text-[10px] text-gray-700 leading-relaxed">
                                <p class="font-semibold text-xs text-gray-900 mb-2">ðŸ‘‹ Hello! I'm your Career Compass AI
                                    assistant.</p>
                                <p class="mb-2">I can help you with:</p>
                                <ul class="space-y-1.5 mb-3">
                                    <li class="flex items-center gap-2"><i data-lucide="check-circle-2"
                                            class="w-3 h-3 text-green-500"></i> Resume optimization tips</li>
                                    <li class="flex items-center gap-2"><i data-lucide="check-circle-2"
                                            class="w-3 h-3 text-green-500"></i> Job search strategies</li>
                                    <li class="flex items-center gap-2"><i data-lucide="check-circle-2"
                                            class="w-3 h-3 text-green-500"></i> Interview preparation</li>
                                    <li class="flex items-center gap-2"><i data-lucide="check-circle-2"
                                            class="w-3 h-3 text-green-500"></i> Career path guidance</li>
                                    <li class="flex items-center gap-2"><i data-lucide="check-circle-2"
                                            class="w-3 h-3 text-green-500"></i> Skill development recommendations
                                    </li>
                                </ul>
                                <p class="font-medium text-primary">What would you like to know?</p>
                            </div>
                            <span class="text-[10px] text-gray-400 ml-1">Just now</span>
                        </div>
                    </div>

                    <!-- Suggested Questions in Chat -->
                    <div class="max-w-md">
                        <p class="text-[9px] font-semibold text-gray-500 mb-2 px-1">Frequently Asked Questions:</p>
                        <div class="grid grid-cols-1 gap-2">
                            <button
                                class="chat-suggested-q text-left p-2 bg-white border border-gray-200 rounded-lg hover:border-primary hover:bg-primary/5 transition-all shadow-sm group">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="help-circle" class="w-2.5 h-2.5 text-primary flex-shrink-0"></i>
                                    <span class="text-[9px] text-gray-700 group-hover:text-primary">I'm not able to
                                        upload
                                        my resume. What do I do?</span>
                                </div>
                            </button>
                            <button
                                class="chat-suggested-q text-left p-2 bg-white border border-gray-200 rounded-lg hover:border-primary hover:bg-primary/5 transition-all shadow-sm group">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="file-warning" class="w-2.5 h-2.5 text-primary flex-shrink-0"></i>
                                    <span class="text-[9px] text-gray-700 group-hover:text-primary">My resume was not
                                        read
                                        correctly. What do I do?</span>
                                </div>
                            </button>
                            <button
                                class="chat-suggested-q text-left p-2 bg-white border border-gray-200 rounded-lg hover:border-primary hover:bg-primary/5 transition-all shadow-sm group">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="briefcase" class="w-2.5 h-2.5 text-primary flex-shrink-0"></i>
                                    <span class="text-[9px] text-gray-700 group-hover:text-primary">I don't have any
                                        work
                                        experience. What should I do?</span>
                                </div>
                            </button>
                        </div>
                    </div>

                </div>

                <!-- Input Area -->
                <div class="p-4 bg-white border-t border-gray-100">
                    <div
                        class="relative flex items-end gap-2 p-2 border border-gray-200 rounded-xl focus-within:ring-2 focus-within:ring-primary/20 focus-within:border-primary transition-all bg-gray-50 focus-within:bg-white">
                        <textarea id="chat-input" rows="1"
                            class="flex-1 bg-transparent border-none focus:ring-0 resize-none py-3 px-3 max-h-32 text-xs text-gray-900 placeholder:text-gray-400"
                            placeholder="Type your message..."></textarea>
                        <button id="send-btn"
                            class="p-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm mb-0.5 hover:shadow-md active:scale-95">
                            <i data-lucide="send" class="w-3 h-3"></i>
                        </button>
                    </div>
                    <p class="text-[9px] text-center text-gray-400 mt-2">
                        AI can make mistakes. Please verify important career info.
                    </p>
                </div>
            </div>

            <!-- Mobile Sidebar Toggle -->
            <!-- (Logic to show sidebar on mobile could be added here, currently hidden on small screens) -->

        </div>
    </main>



    <!-- Scripts -->
    <script src="../js/config.js"></script>
    <script src="../js/script.js"></script>

    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', () => {
            const messagesContainer = document.getElementById('chat-messages');
            const input = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');

            // Auto-resize textarea
            input.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Quick Questions in Sidebar
            document.querySelectorAll('.quick-q').forEach(btn => {
                btn.addEventListener('click', () => {
                    const question = btn.innerText.trim();
                    input.value = question;
                    input.style.height = 'auto';
                    sendMessage();
                });
            });

            // Suggested Questions in Chat
            document.querySelectorAll('.chat-suggested-q').forEach(btn => {
                btn.addEventListener('click', () => {
                    const question = btn.querySelector('span').innerText.trim();
                    input.value = question;
                    input.style.height = 'auto';
                    sendMessage();
                    // Hide suggested questions after use
                    btn.closest('.max-w-2xl').style.display = 'none';
                });
            });

            // Send on Enter (without shift)
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            sendBtn.addEventListener('click', sendMessage);

            function getFAQResponse(question) {
                const faqs = {
                    "I'm not able to upload my resume. What do I do?":
                        "If you're having trouble uploading your resume, try these steps:\n\n1. Make sure your file is in PDF, DOCX, DOC, or TXT format\n2. Ensure the file size is under 5MB\n3. Try using the 'Paste Text' tab instead and copy-paste your resume content\n4. Clear your browser cache and try again\n5. If the issue persists, try a different browser\n\nNeed more help? Feel free to ask!",

                    "My resume was not read correctly. What do I do?":
                        "If your resume wasn't read correctly, here's what you can do:\n\n1. Use the 'Paste Text' option - this often works better than file upload\n2. Make sure your resume has selectable text (not a scanned image)\n3. Avoid complex formatting, tables, or multi-column layouts\n4. Convert your resume to plain text or a simple PDF format\n5. Remove any special characters or unusual fonts\n\nFor best results, use a clean, ATS-friendly resume format!",

                    "I don't have any work experience. What should I do?":
                        "No work experience? No problem! Here's what you can do:\n\n1. Include relevant coursework and academic projects\n2. Add internships or volunteer work - they count as experience\n3. Highlight transferable skills like communication, teamwork, or problem-solving\n4. Include certifications or online courses you've completed\n5. Focus on your education and any academic achievements\n6. Add personal projects or portfolio work\n\nRemember: Everyone starts somewhere, and employers understand that!"
                };

                // Check for exact or partial match
                for (const [key, value] of Object.entries(faqs)) {
                    if (question.includes(key) || key.includes(question)) {
                        return value;
                    }
                }

                return null;
            }

            async function sendMessage() {
                const text = input.value.trim();
                if (!text) return;

                // User Message
                addMessage(text, true);
                input.value = '';
                input.style.height = 'auto';

                // Check for FAQ responses first
                const faqAnswer = getFAQResponse(text);
                if (faqAnswer) {
                    setTimeout(() => {
                        addMessage(faqAnswer, false);
                    }, 500);
                    return;
                }

                // Loading State
                const loadingId = addLoading();

                // Get Context
                let context = {};
                try {
                    const stored = localStorage.getItem('analysisContext');
                    if (stored) context = JSON.parse(stored);
                } catch (e) { }

                try {
                    const res = await fetch(`${CONFIG.API_BASE_URL}/api/ask`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            question: text,
                            resumeText: context.resumeText || '',
                            jobDescription: context.jobDescription || ''
                        })
                    });

                    if (!res.ok) throw new Error('API Error');
                    const data = await res.json();

                    removeLoading(loadingId);
                    addMessage(data.answer, false);

                } catch (err) {
                    removeLoading(loadingId);
                    addMessage("Sorry, I'm having trouble connecting to the server. Please try again.", false);
                }
            }

            function addMessage(text, isUser) {
                const wrapper = document.createElement('div');
                wrapper.className = `flex gap-4 max-w-2xl ${isUser ? 'ml-auto flex-row-reverse' : ''}`;

                const avatar = document.createElement('div');
                avatar.className = `w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mt-1 ${isUser ? 'bg-indigo-600 text-white shadow-md' : 'bg-primary/10 text-primary'}`;
                avatar.innerHTML = `<i data-lucide="${isUser ? 'user' : 'bot'}" class="w-3 h-3"></i>`;

                const contentDiv = document.createElement('div');
                contentDiv.className = "flex flex-col gap-1";

                const bubble = document.createElement('div');
                bubble.className = `p-4 rounded-2xl shadow-sm text-[10px] leading-relaxed ${isUser ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white border border-gray-200 text-gray-700 rounded-tl-none'}`;
                bubble.innerHTML = text.replace(/\n/g, '<br>');

                const time = document.createElement('span');
                time.className = `text-[9px] text-gray-400 ${isUser ? 'text-right' : 'text-left'} ml-1`;
                time.innerText = "Just now";

                contentDiv.appendChild(bubble);
                contentDiv.appendChild(time);

                wrapper.appendChild(avatar);
                wrapper.appendChild(contentDiv);
                messagesContainer.appendChild(wrapper);

                // Re-init generic icons (user/bot)
                lucide.createIcons();
                scrollToBottom();
            }

            function addLoading() {
                const id = 'loading-' + Date.now();
                const wrapper = document.createElement('div');
                wrapper.id = id;
                wrapper.className = 'flex gap-4 max-w-2xl';
                wrapper.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-1">
                        <i data-lucide="bot" class="w-3 h-3 text-primary"></i>
                    </div>
                    <div class="bg-white border border-gray-200 p-4 rounded-2xl rounded-tl-none shadow-sm flex gap-2 items-center">
                        <div class="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0s"></div>
                        <div class="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        <div class="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                    </div>
                `;
                messagesContainer.appendChild(wrapper);
                lucide.createIcons();
                scrollToBottom();
                return id;
            }

            function removeLoading(id) {
                const el = document.getElementById(id);
                if (el) el.remove();
            }

            function scrollToBottom() {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        });
    </script>
</body>

</html>